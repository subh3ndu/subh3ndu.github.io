<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Tmp2sH5uRFm4L</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <style type="text/css">:root {--c-caption: grey;--c-blue: #26bfe3;--c-green: #02e180;--c-orange: #f2971a;--c-pink: #e3266f;--c-bg: #fff;--c-bg-alt: #f5f5f5;--c-text-header: #fff;--c-text-body: #95989a;--padding: 20px;--padding-inv: calc(-1 * var(--padding));--fonts: "Open Sans", -apple-system, system-ui, "Segoe UI", "Roboto","Helvetica Neue", Arial, sans-serif;--font-size: 1.1rem;}html {font-size: 100%;}body {color: #444;font-family: var(--fonts);font-size: var(--font-size);line-height: 1.7;padding: 1em;margin: auto;max-width: 800px;background: #fefefe;}a {color: #0645ad;text-decoration: none;}a:visited {color: #0b0080;}a:hover {color: #06e;}a:active {color: #faa700;}a:focus {outline: thin dotted;}a::selection {background: rgba(255, 255, 0, 0.3);color: #0645ad;}*::selection {background: rgba(255, 255, 0, 0.3);color: #000;}p {margin: 1em 0;}.caption {text-align: center;color: var(--c-caption);font-style: italic;}.note,.tips,.warning {display: block;width: calc(100% - var(--padding) * 2);padding: 0 var(--padding);padding-bottom: var(--padding);background-color: var(--c-bg-alt);}.note:before,.tips:before,.warning:before {display: block;margin: 0 var(--padding-inv) 10px var(--padding-inv);padding-left: var(--padding);font-style: bold;color: white;}.note:before {content: "Note";background-color: var(--c-blue);}.tips:before {content: "Tips";background-color: var(--c-pink);}.warning:before {content: "Warning";background-color: var(--c-orange);}img {max-width: 100%;}h1,h2,h3,h4,h5,h6 {color: #111;line-height: 125%;margin-top: 2em;font-weight: normal;}h4,h5,h6 {font-weight: bold;}h1 {font-size: 2.5em;}h2 {font-size: 2em;}h3 {font-size: 1.5em;}h4 {font-size: 1.2em;}blockquote {color: #666666;margin: 0;padding-left: 3em;border-left: 0.5em #eee solid;}hr {display: block;height: 2px;border: 0;border-top: 1px solid #aaa;border-bottom: 1px solid #eee;margin: 1em 0;padding: 0;}pre,code,kbd,samp {color: #0084b8;font-family: monospace, monospace;}pre {background-color: #f9f9f9;padding: 1em;font-size: 14px;white-space: pre-wrap;word-wrap: break-word;}code {white-space: pre-wrap;}b,strong {font-weight: bold;}dfn {font-style: italic;color: var(--c-blue);}ins {background: #ff9;color: #000;text-decoration: none;}ul,ol {margin: 1em 0;padding: 0 0 0 2em;}li p:last-child {margin-bottom: 0;}ul ul,ol ol {margin: 0.3em 0;}dl {margin-bottom: 1em;}dt {font-weight: bold;margin-bottom: 0.8em;}dd {margin: 0 0 0.8em 2em;}dd:last-child {margin-bottom: 0;}img {border: 0;-ms-interpolation-mode: bicubic;vertical-align: middle;}figure {display: block;text-align: center;margin: 1em 0;}figure img {border: none;margin: 0 auto;}figcaption {font-size: 0.8em;font-style: italic;margin: 0 0 0.8em;}.author {font-size: 1.2em;text-align: center;}tag {min-width: 3.2em;text-align: center;border-radius: 8px;padding: 0 4px;margin-bottom: 0;margin-top: 4px;margin-right: 0.2em;display: inline-block;color: white;}tag.update {background: var(--c-blue);}tag.new {background: var(--c-green);}tag.update:after {content: "update";}tag.new:after {content: "new";}button {background-color: var(--c-blue);color: white;border: none;cursor: pointer;line-height: 2rem;font-size: 1.2rem;margin: 0.75rem 0;overflow: visible;padding: 0.75rem 1.5rem;border-radius: 1rem;transition: background-color $transition-duration;white-space: nowrap;}</style>
</head>
<body>
<h1 id="inventory-slots-for-specific-items">Inventory slots for specific items</h1>
<p>The Stirling engine has been this source of unending cosmic power this entire time, providing flat <code>25</code> units of power forever.</p>
<p>That’s useful, but not precisely balanced.</p>
<p>A Stirling engine has gas in its chamber, and applying heat causes it to expand and push the piston.</p>
<p>We should provide a slot that can accept nothing but fuel, like charcoal. The engine burns one piece of it at a time to produce power for a limited duration.</p>
<p>To do so, we need to add the ability only to accept some items.</p>
<p>Right now, we can put any item in any inventory slot. But we want the engine only to accept fuel sources. To do so, we’ll implement item filters.</p>
<h2 id="item-filters">Item filters</h2>
<p>Filters are a set of keywords that refer either to a category of objects, like “Fuels”, or to a specific item, like “Ore”.</p>
<p>When the user clicks on a panel with an item, we check that the selected item matches the defined filter, if applicable.</p>
<p>We’ll create the filter list as a space-delineated string on the <code>InventoryBar</code> and split it into an array. We’ll then check the array’s content with the <code>in</code> keyword.</p>
<p>Why have our filter as a string and turn it into an array? After all, we could export an array and edit it straight in the inspector.</p>
<p>However, in Godot 3.2, the experience editing arrays in the inspector is a bit tedious, which is why I went with a text string that I split.</p>
<p><em>Note that you can also use the <code>in</code> keyword to test if a string is part of another, so you could alternatively implement everything we’ll see below without arrays.</em></p>
<p>With that explanation out of the way, open up <code>InventoryBar.gd</code> to create the filter list.</p>
<p>To prevent items from automatically going into the inventory when the filter doesn’t fit, we’ll update <code>add_to_first_available_inventory()</code>.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#75715e">## A textual representation of the possible items or categories of items the</span>
<span style="color:#75715e">## panels can accept, separated by spaces.</span>
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> item_filters :<span style="color:#f92672">=</span> <span style="color:#e6db74">&quot;&quot;</span>
<span style="color:#75715e">## The list split into an array of names. The second parameter prevents us from</span>
<span style="color:#75715e">## having empty strings (&quot;&quot;) in the array.</span>
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> item_filters<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&quot; &quot;</span>, false)


<span style="color:#66d9ef">func</span> setup(gui: <span style="color:#a6e22e">Control</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e">#...</span>
    <span style="color:#75715e">#for panel in panels:</span>
        <span style="color:#75715e"># Here, we update the existing call to `setup()` and provide the filter</span>
        <span style="color:#75715e"># array to the panel children when we set them up.</span>
        <span style="color:#75715e"># We&#39;ll update the panel&#39;s `setup()` function definition in a moment.</span>
        panel<span style="color:#f92672">.</span>setup(gui, _filter_list)
        <span style="color:#75715e">#...</span>


<span style="color:#66d9ef">func</span> add_to_first_available_inventory(item: BlueprintEntity) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#75715e">#var item_name := Library.get_entity_name_from(item)</span>
    
    <span style="color:#75715e"># We provide the filter list and the name of the item to a special function</span>
    <span style="color:#75715e"># in `Library` to report on whether this is a valid item for the bar.</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, item_name):
        <span style="color:#66d9ef">return</span> false
    <span style="color:#75715e"># ...</span>


<span style="color:#75715e">## When we consume an item like fuel, we need a way to make sure the stack count</span>
<span style="color:#75715e">## is up to date.</span>
<span style="color:#75715e">## this helper function will keep the label up to date on its panel children.</span>
<span style="color:#66d9ef">func</span> update_labels() <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        <span style="color:#66d9ef">if</span> panel<span style="color:#f92672">.</span>held_item:
            panel<span style="color:#f92672">.</span>_update_label()
</pre>
<p>As you can see, our new code depends on a special function in <code>Library</code>: <code>is_valid_filter()</code>.</p>
<p>The function will take an array of filter names and the item to compare.</p>
<p>This will allow us to compare items to entire categories like fuels.</p>
<p>Let’s open <code>Library.gd</code> to add this function.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#75715e">## Returns `true` if the provided item matches the provided filter array.</span>
<span style="color:#66d9ef">func</span> is_valid_filter(filter_list: <span style="color:#a6e22e">Array</span>, item_name: <span style="color:#a6e22e">String</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#75715e"># If the filter list is empty, then it&#39;s automatically allowed.</span>
    <span style="color:#75715e"># Otherwise, we check first if the item is explicitly listed in the list.</span>
    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>empty() <span style="color:#f92672">or</span> item_name <span style="color:#f92672">in</span> filter_list:
        <span style="color:#66d9ef">return</span> true

    <span style="color:#75715e"># If it&#39;s not, we check any listed item categories in the filter list and if</span>
    <span style="color:#75715e"># there&#39;s one defined, we look it up in the recipes.</span>
    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>has(<span style="color:#e6db74">&quot;Fuels&quot;</span>) <span style="color:#f92672">and</span> Recipes<span style="color:#f92672">.</span>Fuels<span style="color:#f92672">.</span>has(item_name):
        <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">return</span> false
</pre>
<p>This takes us to <code>Recipes</code>, where we can check to see if the item belongs to that particular category of objects.</p>
<p>That lets us make an inventory that only accepts fuels by listing “Fuels” without going through and listing “Lumber” and “Branches” individually.</p>
<p>What if we decided to add “Coal” and “NuclearCell” in the future?</p>
<p>We’d have to go through every machine and entity that takes fuel and update each one!</p>
<p>It’s much easier just to say “Fuels” and use the category throughout our codebase.</p>
<p>Head to <code>Recipes.gd</code> to add this new dictionary.</p>
<p>We can add some recipes to the <code>Crafting</code> dictionary for the new entities we’ve been creating the last few lessons while we’re here.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">const</span> Crafting :<span style="color:#f92672">=</span> {
    <span style="color:#75715e">#...</span>
    <span style="color:#75715e"># We append new recipes to the existing list.</span>
    Pickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudePickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Axe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudeAxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Branches <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&quot;Axe&quot;</span>: <span style="color:#ae81ff">0</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>},
    Chest <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">1</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>}
}

<span style="color:#75715e">## Holds a dictionary of the types of things that are considered fuels and how</span>
<span style="color:#75715e">## much work time they provide in seconds when burnt.</span>
<span style="color:#66d9ef">const</span> Fuels :<span style="color:#f92672">=</span> {Lumber <span style="color:#f92672">=</span> <span style="color:#ae81ff">50.0</span>, Branches <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>}
</pre>
<p>The last place to update with this new filtering ability is <code>InventoryPanel.gd</code>, to prevent the user from putting stuff where it shouldn’t fit.</p>
<p>We need to update the <code>setup()</code> function to store the list and then use it in <code>_gui_input()</code>.</p>
<p>Below, we update three lines that checked for <code>left_click</code> or <code>right_click</code> to also check for the item filter.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> []


<span style="color:#75715e"># Below, I included some existing lines of code in comments to help you track down the ones to update.</span>
<span style="color:#66d9ef">func</span> _gui_input(event: <span style="color:#a6e22e">InputEvent</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e">#...</span>
    <span style="color:#75715e">#if left_click or right_click:</span>
        <span style="color:#75715e">#if gui.blueprint:</span>
            <span style="color:#75715e">#var blueprint_name := Library.get_entity_name_from(gui.blueprint)</span>
            <span style="color:#75715e">#if held_item:</span>
                <span style="color:#75715e">#...</span>

                <span style="color:#75715e">#if item_is_same_type and stack_has_space:</span>
                    <span style="color:#75715e">#...</span>
                <span style="color:#75715e">#else:</span>
                    <span style="color:#75715e"># We replace the existing</span>
                    <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, held_item_name):
                        <span style="color:#75715e">#_swap_items()</span>
            <span style="color:#75715e">#else:</span>
                <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    <span style="color:#75715e">#_grab_item()</span>

                <span style="color:#66d9ef">elif</span> right_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    <span style="color:#75715e">#...</span>
    <span style="color:#75715e">#...</span>


<span style="color:#75715e">## Notice the new argument below, `filter_list`.</span>
<span style="color:#66d9ef">func</span> setup(_gui: <span style="color:#a6e22e">Control</span>, filter_list :<span style="color:#f92672">=</span> []) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#75715e">#...</span>
    _filter_list <span style="color:#f92672">=</span> filter_list
</pre>
<p>That should do it for filtering the inventory.</p>
<p>In the next lesson, we’ll design the Stirling engine’s user interface and put our filter to use. The engine will only accept fuel.</p>
<h2 id="code-reference">Code reference</h2>
<p>In <code>InventoryBar.gd</code>, we added two properties, the <code>update_labels()</code> function, and updated the <code>add_to_first_available_inventory()</code> and <code>setup()</code> functions.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> item_filters :<span style="color:#f92672">=</span> <span style="color:#e6db74">&quot;&quot;</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> item_filters<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&quot; &quot;</span>, false)


<span style="color:#66d9ef">func</span> setup(gui: <span style="color:#a6e22e">Control</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">if</span> setup:
        <span style="color:#66d9ef">return</span>

    setup <span style="color:#f92672">=</span> true

    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        panel<span style="color:#f92672">.</span>setup(gui, _filter_list)
        panel<span style="color:#f92672">.</span>connect(<span style="color:#e6db74">&quot;held_item_changed&quot;</span>, self, <span style="color:#e6db74">&quot;_on_Panel_held_item_changed&quot;</span>)


<span style="color:#66d9ef">func</span> add_to_first_available_inventory(item: BlueprintEntity) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">var</span> item_name :<span style="color:#f92672">=</span> Library<span style="color:#f92672">.</span>get_entity_name_from(item)

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, item_name):
        <span style="color:#66d9ef">return</span> false

    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        <span style="color:#66d9ef">if</span> (
            panel<span style="color:#f92672">.</span>held_item
            <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>get_entity_name_from(panel<span style="color:#f92672">.</span>held_item) <span style="color:#f92672">==</span> item_name
            <span style="color:#f92672">and</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&lt;</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_size
        ):
            <span style="color:#66d9ef">var</span> available_space: <span style="color:#a6e22e">int</span> <span style="color:#f92672">=</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_size <span style="color:#f92672">-</span> panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count
            
            <span style="color:#66d9ef">if</span> item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&gt;</span> available_space:
                <span style="color:#66d9ef">var</span> transfer_count :<span style="color:#f92672">=</span> item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">-</span> available_space
                panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">+=</span> transfer_count
                item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">-=</span> transfer_count
            <span style="color:#66d9ef">else</span>:
                panel<span style="color:#f92672">.</span>held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">+=</span> item<span style="color:#f92672">.</span>stack_count
                item<span style="color:#f92672">.</span>queue_free()
                <span style="color:#66d9ef">return</span> true

        <span style="color:#66d9ef">elif</span> <span style="color:#f92672">not</span> panel<span style="color:#f92672">.</span>held_item:
            panel<span style="color:#f92672">.</span>held_item <span style="color:#f92672">=</span> item
            <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">return</span> false


<span style="color:#66d9ef">func</span> update_labels() <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">for</span> panel <span style="color:#f92672">in</span> panels:
        <span style="color:#66d9ef">if</span> panel<span style="color:#f92672">.</span>held_item:
            panel<span style="color:#f92672">.</span>_update_label()
</pre>
<p>In <code>Library.gd</code>, we added one function, <code>is_valid_filter()</code>.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> is_valid_filter(filter_list: <span style="color:#a6e22e">Array</span>, item_name: <span style="color:#a6e22e">String</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>empty() <span style="color:#f92672">or</span> item_name <span style="color:#f92672">in</span> filter_list:
        <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">if</span> filter_list<span style="color:#f92672">.</span>has(<span style="color:#e6db74">&quot;Fuels&quot;</span>) <span style="color:#f92672">and</span> Recipes<span style="color:#f92672">.</span>Fuels<span style="color:#f92672">.</span>has(item_name):
        <span style="color:#66d9ef">return</span> true

    <span style="color:#66d9ef">return</span> false
</pre>
<p><code>Recipes.gd</code></p>
<pre style="color:#f8f8f2;background-color:#272822">class_name Recipes
<span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Reference</span>

<span style="color:#66d9ef">const</span> Crafting :<span style="color:#f92672">=</span> {
    StirlingEngine <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&quot;Wire&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Wire <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">2</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>},
    Battery <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">12</span>, <span style="color:#e6db74">&quot;Wire&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Pickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudePickaxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Axe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">3</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    CrudeAxe <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Stone&quot;</span>: <span style="color:#ae81ff">5</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>},
    Branches <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&quot;Axe&quot;</span>: <span style="color:#ae81ff">0</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>},
    Chest <span style="color:#f92672">=</span> {inputs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&quot;Lumber&quot;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&quot;Branches&quot;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&quot;Ingot&quot;</span>: <span style="color:#ae81ff">1</span>}, amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>}
}

<span style="color:#66d9ef">const</span> Fuels :<span style="color:#f92672">=</span> {Lumber <span style="color:#f92672">=</span> <span style="color:#ae81ff">50.0</span>, Branches <span style="color:#f92672">=</span> <span style="color:#ae81ff">10.0</span>}
</pre>
<p>In <code>InventoryPanel.gd</code>, we added the <code>_filter_list</code> property, and updated <code>_gui_input()</code> and <code>setup()</code>.</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">var</span> _filter_list :<span style="color:#f92672">=</span> []


<span style="color:#66d9ef">func</span> _gui_input(event: <span style="color:#a6e22e">InputEvent</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">var</span> left_click :<span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&quot;left_click&quot;</span>)
    <span style="color:#66d9ef">var</span> right_click :<span style="color:#f92672">=</span> event<span style="color:#f92672">.</span>is_action_pressed(<span style="color:#e6db74">&quot;right_click&quot;</span>)

    <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">or</span> right_click:
        <span style="color:#66d9ef">if</span> gui<span style="color:#f92672">.</span>blueprint:
            <span style="color:#66d9ef">var</span> blueprint_name :<span style="color:#f92672">=</span> Library<span style="color:#f92672">.</span>get_entity_name_from(gui<span style="color:#f92672">.</span>blueprint)
            <span style="color:#66d9ef">if</span> held_item:
                <span style="color:#66d9ef">var</span> held_item_name :<span style="color:#f92672">=</span> Library<span style="color:#f92672">.</span>get_entity_name_from(held_item)

                <span style="color:#66d9ef">var</span> item_is_same_type: <span style="color:#a6e22e">bool</span> <span style="color:#f92672">=</span> held_item_name <span style="color:#f92672">==</span> blueprint_name
                <span style="color:#66d9ef">var</span> stack_has_space: <span style="color:#a6e22e">bool</span> <span style="color:#f92672">=</span> held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&lt;</span> held_item<span style="color:#f92672">.</span>stack_size

                <span style="color:#66d9ef">if</span> item_is_same_type <span style="color:#f92672">and</span> stack_has_space:
                    <span style="color:#66d9ef">if</span> left_click:
                        _stack_items()
                    <span style="color:#66d9ef">elif</span> right_click:
                        _stack_items(true)
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, held_item_name):
                        _swap_items()
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">if</span> left_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    _grab_item()
                <span style="color:#66d9ef">elif</span> right_click <span style="color:#f92672">and</span> Library<span style="color:#f92672">.</span>is_valid_filter(_filter_list, blueprint_name):
                    <span style="color:#66d9ef">if</span> gui<span style="color:#f92672">.</span>blueprint<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
                        _grab_split_items()
                    <span style="color:#66d9ef">else</span>:
                        _grab_item()
        <span style="color:#66d9ef">elif</span> held_item:
            <span style="color:#66d9ef">if</span> left_click:
                _release_item()
            <span style="color:#66d9ef">elif</span> right_click:
                <span style="color:#66d9ef">if</span> held_item<span style="color:#f92672">.</span>stack_count <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
                    _release_item()
                <span style="color:#66d9ef">else</span>:
                    _split_items()

    <span style="color:#66d9ef">elif</span> event is <span style="color:#a6e22e">InputEventMouseMotion</span> <span style="color:#f92672">and</span> held_item:
        Events<span style="color:#f92672">.</span>emit_signal(<span style="color:#e6db74">&quot;hovered_over_entity&quot;</span>, held_item)


<span style="color:#66d9ef">func</span> setup(_gui: <span style="color:#a6e22e">Control</span>, filter_list :<span style="color:#f92672">=</span> []) <span style="color:#f92672">-&gt;</span> void:
    gui <span style="color:#f92672">=</span> _gui
    _filter_list <span style="color:#f92672">=</span> filter_list
</pre>
</body>
</html>
