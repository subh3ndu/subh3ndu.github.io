<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>TmpqUDfrgoLgL</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <style type="text/css">:root {--c-caption: grey;--c-blue: #26bfe3;--c-green: #02e180;--c-orange: #f2971a;--c-pink: #e3266f;--c-bg: #fff;--c-bg-alt: #f5f5f5;--c-text-header: #fff;--c-text-body: #95989a;--padding: 20px;--padding-inv: calc(-1 * var(--padding));--fonts: "Open Sans", -apple-system, system-ui, "Segoe UI", "Roboto","Helvetica Neue", Arial, sans-serif;--font-size: 1.1rem;}html {font-size: 100%;}body {color: #444;font-family: var(--fonts);font-size: var(--font-size);line-height: 1.7;padding: 1em;margin: auto;max-width: 800px;background: #fefefe;}a {color: #0645ad;text-decoration: none;}a:visited {color: #0b0080;}a:hover {color: #06e;}a:active {color: #faa700;}a:focus {outline: thin dotted;}a::selection {background: rgba(255, 255, 0, 0.3);color: #0645ad;}*::selection {background: rgba(255, 255, 0, 0.3);color: #000;}p {margin: 1em 0;}.caption {text-align: center;color: var(--c-caption);font-style: italic;}.note,.tips,.warning {display: block;width: calc(100% - var(--padding) * 2);padding: 0 var(--padding);padding-bottom: var(--padding);background-color: var(--c-bg-alt);}.note:before,.tips:before,.warning:before {display: block;margin: 0 var(--padding-inv) 10px var(--padding-inv);padding-left: var(--padding);font-style: bold;color: white;}.note:before {content: "Note";background-color: var(--c-blue);}.tips:before {content: "Tips";background-color: var(--c-pink);}.warning:before {content: "Warning";background-color: var(--c-orange);}img {max-width: 100%;}h1,h2,h3,h4,h5,h6 {color: #111;line-height: 125%;margin-top: 2em;font-weight: normal;}h4,h5,h6 {font-weight: bold;}h1 {font-size: 2.5em;}h2 {font-size: 2em;}h3 {font-size: 1.5em;}h4 {font-size: 1.2em;}blockquote {color: #666666;margin: 0;padding-left: 3em;border-left: 0.5em #eee solid;}hr {display: block;height: 2px;border: 0;border-top: 1px solid #aaa;border-bottom: 1px solid #eee;margin: 1em 0;padding: 0;}pre,code,kbd,samp {color: #0084b8;font-family: monospace, monospace;}pre {background-color: #f9f9f9;padding: 1em;font-size: 14px;white-space: pre-wrap;word-wrap: break-word;}code {white-space: pre-wrap;}b,strong {font-weight: bold;}dfn {font-style: italic;color: var(--c-blue);}ins {background: #ff9;color: #000;text-decoration: none;}ul,ol {margin: 1em 0;padding: 0 0 0 2em;}li p:last-child {margin-bottom: 0;}ul ul,ol ol {margin: 0.3em 0;}dl {margin-bottom: 1em;}dt {font-weight: bold;margin-bottom: 0.8em;}dd {margin: 0 0 0.8em 2em;}dd:last-child {margin-bottom: 0;}img {border: 0;-ms-interpolation-mode: bicubic;vertical-align: middle;}figure {display: block;text-align: center;margin: 1em 0;}figure img {border: none;margin: 0 auto;}figcaption {font-size: 0.8em;font-style: italic;margin: 0 0 0.8em;}.author {font-size: 1.2em;text-align: center;}tag {min-width: 3.2em;text-align: center;border-radius: 8px;padding: 0 4px;margin-bottom: 0;margin-top: 4px;margin-right: 0.2em;display: inline-block;color: white;}tag.update {background: var(--c-blue);}tag.new {background: var(--c-green);}tag.update:after {content: "update";}tag.new:after {content: "new";}button {background-color: var(--c-blue);color: white;border: none;cursor: pointer;line-height: 2rem;font-size: 1.2rem;margin: 0.75rem 0;overflow: visible;padding: 0.75rem 1.5rem;border-radius: 1rem;transition: background-color $transition-duration;white-space: nowrap;}</style>
</head>
<body>
<h1 id="creating-organic-room-shapes">Creating organic room shapes</h1>
<p>In this lesson we’ll build on top of the previous part to expand the dungeon generator with mixed rectangular and organic rooms.</p>
<figure>
<img src="data:image/png;base64,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" alt />
</figure>
<p>To render out the organic room data we’ll use the <code>Geometry.is_point_in_polygon()</code> built-in function, which as the name implies, checks if a point falls within the given polygon.</p>
<p>Add the following at the end of your <code>BasicDungeon.gd</code> script:</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> _lessv_x(v1: <span style="color:#a6e22e">Vector2</span>, v2: <span style="color:#a6e22e">Vector2</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">return</span> v1<span style="color:#f92672">.</span>x <span style="color:#f92672">&lt;</span> v2<span style="color:#f92672">.</span>x


<span style="color:#66d9ef">func</span> _lessv_y(v1: <span style="color:#a6e22e">Vector2</span>, v2: <span style="color:#a6e22e">Vector2</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">return</span> v1<span style="color:#f92672">.</span>y <span style="color:#f92672">&lt;</span> v2<span style="color:#f92672">.</span>y
</pre>
<p>These are helper functions which we’ll use in <code>_add_room()</code> once we update it to also create polygonal rooms.</p>
<p>Before moving on, also make sure to declare:</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">const</span> FACTOR :<span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">8.0</span>
</pre>
<p>at the top of your script as well. It’s a constant we’ll be using in <code>_add_room()</code>:</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> _add_room(rng: RandomNumberGenerator, data: <span style="color:#a6e22e">Dictionary</span>, rooms: <span style="color:#a6e22e">Array</span>, room: <span style="color:#a6e22e">Rect2</span>) <span style="color:#f92672">-&gt;</span> void:
    rooms<span style="color:#f92672">.</span>push_back(room)
    <span style="color:#66d9ef">if</span> rng<span style="color:#f92672">.</span>randi_range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>x):
            <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>y):
                data[<span style="color:#a6e22e">Vector2</span>(x, y)] <span style="color:#f92672">=</span> null
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">var</span> unit :<span style="color:#f92672">=</span> FACTOR <span style="color:#f92672">*</span> room<span style="color:#f92672">.</span>size
        <span style="color:#66d9ef">var</span> order :<span style="color:#f92672">=</span> [
            room<span style="color:#f92672">.</span>grow_individual(<span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, unit<span style="color:#f92672">.</span>y <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>y),
            room<span style="color:#f92672">.</span>grow_individual(unit<span style="color:#f92672">.</span>x <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>x, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y),
            room<span style="color:#f92672">.</span>grow_individual(<span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, unit<span style="color:#f92672">.</span>y <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>y, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, <span style="color:#ae81ff">0</span>),
            room<span style="color:#f92672">.</span>grow_individual(<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y, unit<span style="color:#f92672">.</span>x <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>x, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y)
        ]
        <span style="color:#66d9ef">var</span> poly :<span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> range(order<span style="color:#f92672">.</span>size()):
            <span style="color:#66d9ef">var</span> rect: <span style="color:#a6e22e">Rect2</span> <span style="color:#f92672">=</span> order[index]
            <span style="color:#66d9ef">var</span> is_even :<span style="color:#f92672">=</span> index <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">var</span> poly_partial :<span style="color:#f92672">=</span> []
            <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(rng<span style="color:#f92672">.</span>randi_range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)):
                poly_partial<span style="color:#f92672">.</span>push_back(<span style="color:#a6e22e">Vector2</span>(
                    rng<span style="color:#f92672">.</span>randf_range(rect<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x, rect<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>x),
                    rng<span style="color:#f92672">.</span>randf_range(rect<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y, rect<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>y)
                ))
            poly_partial<span style="color:#f92672">.</span>sort_custom(self, <span style="color:#e6db74">&quot;_lessv_x&quot;</span> <span style="color:#66d9ef">if</span> is_even <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&quot;_lessv_y&quot;</span>)
            <span style="color:#66d9ef">if</span> index <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
                poly_partial<span style="color:#f92672">.</span>invert()
            poly <span style="color:#f92672">+=</span> poly_partial

        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>x):
            <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>y):
                <span style="color:#66d9ef">var</span> point :<span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(x, y)
                <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Geometry</span><span style="color:#f92672">.</span>is_point_in_polygon(point, poly):
                    data[point] <span style="color:#f92672">=</span> null
</pre>
<p>That’s all there is to it. Now we have a working basic dungeon generator that picks either rectangular or organic (polygonal) rooms to place on each iteration.</p>
<p>Let’s go over the modifications.</p>
<p>Since we’ll have to pick which type of room to place: rectangular or organic, we need to pass in the <code>RandomNumberGenerator</code> so we have to modify the function signature appropriately:</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">func</span> _add_room(rng: RandomNumberGenerator, data: <span style="color:#a6e22e">Dictionary</span>, rooms: <span style="color:#a6e22e">Array</span>, room: <span style="color:#a6e22e">Rect2</span>) <span style="color:#f92672">-&gt;</span> void:
</pre>
<p>We then pick either the rectangular room or the organic room with a 50% chance based on <code>rng.randi_range(0, 1)</code>. The code for adding the rectangular room hasn’t changed so we’ll focus on the else branch:</p>
<ol type="1">
<li>Given the same rectangular room information.</li>
<li>We first store a <code>unit</code> size based on <code>FACTOR</code> and the given room size.</li>
<li>Using <code>unit</code>, we create the four rectangles in an ordered array with the help of <code>Rect2.grow_individual()</code>.</li>
<li>For each of these rectangles we generate 1 to 2 points randomly and save them in <code>poly_partial</code>.</li>
<li>We then use the helper functions <code>_lessv_x()</code> or <code>_lessv_y()</code> depending on <code>index</code> to sort this array so that we have the points in clock-wise order. Each iteration we append <code>poly_partial</code> to <code>poly</code>. Now we’re ready to generate the actual room data based on this polygon.</li>
<li>To do this we iterate over <code>room.position</code> and <code>room.end</code>, just like in the rectangular rooms case, but this time we check if the given <code>point</code> is inside the constructed polygon with the help of <code>Geometry.is_point_in_polygon()</code>. We save the information only if the test succeeds.</li>
</ol>
<figure>
<img src="data:image/png;base64,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" alt />
</figure>
<p>And that’s all there is to it. Now we have extended our algorithm to generate both rectangular and organic rooms randomly.</p>
<h2 id="references">References</h2>
<p>Here’s the entire code up to this point:</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Node2D</span>


<span style="color:#66d9ef">const</span> FACTOR :<span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">8.0</span>

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> level_size :<span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">80</span>)
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> rooms_size :<span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">14</span>)
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">var</span> rooms_max :<span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>

<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> level: <span style="color:#a6e22e">TileMap</span> <span style="color:#f92672">=</span> <span style="color:#f92672">$</span>Level
<span style="color:#66d9ef">onready</span> <span style="color:#66d9ef">var</span> camera: <span style="color:#a6e22e">Camera2D</span> <span style="color:#f92672">=</span> <span style="color:#f92672">$</span><span style="color:#a6e22e">Camera2D</span>


<span style="color:#66d9ef">func</span> _ready() <span style="color:#f92672">-&gt;</span> void:
    _setup_camera()
    _generate()


<span style="color:#66d9ef">func</span> _setup_camera() <span style="color:#f92672">-&gt;</span> void:
    camera<span style="color:#f92672">.</span>position <span style="color:#f92672">=</span> level<span style="color:#f92672">.</span>map_to_world(level_size <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)
    <span style="color:#66d9ef">var</span> z :<span style="color:#f92672">=</span> max(level_size<span style="color:#f92672">.</span>x, level_size<span style="color:#f92672">.</span>y) <span style="color:#f92672">/</span> <span style="color:#ae81ff">8</span>
    camera<span style="color:#f92672">.</span>zoom <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(z, z)


<span style="color:#66d9ef">func</span> _generate() <span style="color:#f92672">-&gt;</span> void:
    level<span style="color:#f92672">.</span>clear()
    <span style="color:#66d9ef">for</span> vector <span style="color:#f92672">in</span> _generate_data():
        level<span style="color:#f92672">.</span>set_cellv(vector, <span style="color:#ae81ff">0</span>)


<span style="color:#66d9ef">func</span> _generate_data() <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">Array</span>:
    <span style="color:#66d9ef">var</span> rng :<span style="color:#f92672">=</span> RandomNumberGenerator<span style="color:#f92672">.</span>new()
    rng<span style="color:#f92672">.</span>randomize()

    <span style="color:#66d9ef">var</span> data :<span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">var</span> rooms :<span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(rooms_max):
        <span style="color:#66d9ef">var</span> room :<span style="color:#f92672">=</span> _get_random_room(rng)
        <span style="color:#66d9ef">if</span> _intersects(rooms, room):
            <span style="color:#66d9ef">continue</span>

        _add_room(rng, data, rooms, room)
        <span style="color:#66d9ef">if</span> rooms<span style="color:#f92672">.</span>size() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
            <span style="color:#66d9ef">var</span> room_previous: <span style="color:#a6e22e">Rect2</span> <span style="color:#f92672">=</span> rooms[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
            _add_connection(rng, data, room_previous, room)
    <span style="color:#66d9ef">return</span> data<span style="color:#f92672">.</span>keys()


<span style="color:#66d9ef">func</span> _get_random_room(rng: RandomNumberGenerator) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">Rect2</span>:
    <span style="color:#66d9ef">var</span> width :<span style="color:#f92672">=</span> rng<span style="color:#f92672">.</span>randi_range(rooms_size<span style="color:#f92672">.</span>x, rooms_size<span style="color:#f92672">.</span>y)
    <span style="color:#66d9ef">var</span> height :<span style="color:#f92672">=</span> rng<span style="color:#f92672">.</span>randi_range(rooms_size<span style="color:#f92672">.</span>x, rooms_size<span style="color:#f92672">.</span>y)
    <span style="color:#66d9ef">var</span> x :<span style="color:#f92672">=</span> rng<span style="color:#f92672">.</span>randi_range(<span style="color:#ae81ff">0</span>, level_size<span style="color:#f92672">.</span>x <span style="color:#f92672">-</span> width <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">var</span> y :<span style="color:#f92672">=</span> rng<span style="color:#f92672">.</span>randi_range(<span style="color:#ae81ff">0</span>, level_size<span style="color:#f92672">.</span>y <span style="color:#f92672">-</span> height <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Rect2</span>(x, y, width, height)


<span style="color:#66d9ef">func</span> _add_room(rng: RandomNumberGenerator, data: <span style="color:#a6e22e">Dictionary</span>, rooms: <span style="color:#a6e22e">Array</span>, room: <span style="color:#a6e22e">Rect2</span>) <span style="color:#f92672">-&gt;</span> void:
    rooms<span style="color:#f92672">.</span>push_back(room)
    <span style="color:#66d9ef">if</span> rng<span style="color:#f92672">.</span>randi_range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>x):
            <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>y):
                data[<span style="color:#a6e22e">Vector2</span>(x, y)] <span style="color:#f92672">=</span> null
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">var</span> unit :<span style="color:#f92672">=</span> FACTOR <span style="color:#f92672">*</span> room<span style="color:#f92672">.</span>size
        <span style="color:#66d9ef">var</span> order :<span style="color:#f92672">=</span> [
            room<span style="color:#f92672">.</span>grow_individual(<span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, unit<span style="color:#f92672">.</span>y <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>y),
            room<span style="color:#f92672">.</span>grow_individual(unit<span style="color:#f92672">.</span>x <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>x, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y),
            room<span style="color:#f92672">.</span>grow_individual(<span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, unit<span style="color:#f92672">.</span>y <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>y, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>x, <span style="color:#ae81ff">0</span>),
            room<span style="color:#f92672">.</span>grow_individual(<span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y, unit<span style="color:#f92672">.</span>x <span style="color:#f92672">-</span> room<span style="color:#f92672">.</span>size<span style="color:#f92672">.</span>x, <span style="color:#f92672">-</span>unit<span style="color:#f92672">.</span>y)
        ]
        <span style="color:#66d9ef">var</span> poly :<span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> index <span style="color:#f92672">in</span> range(order<span style="color:#f92672">.</span>size()):
            <span style="color:#66d9ef">var</span> rect: <span style="color:#a6e22e">Rect2</span> <span style="color:#f92672">=</span> order[index]
            <span style="color:#66d9ef">var</span> is_even :<span style="color:#f92672">=</span> index <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">var</span> poly_partial :<span style="color:#f92672">=</span> []
            <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> range(rng<span style="color:#f92672">.</span>randi_range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)):
                poly_partial<span style="color:#f92672">.</span>push_back(<span style="color:#a6e22e">Vector2</span>(
                    rng<span style="color:#f92672">.</span>randf_range(rect<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x, rect<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>x),
                    rng<span style="color:#f92672">.</span>randf_range(rect<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y, rect<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>y)
                ))
            poly_partial<span style="color:#f92672">.</span>sort_custom(self, <span style="color:#e6db74">&quot;_lessv_x&quot;</span> <span style="color:#66d9ef">if</span> is_even <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&quot;_lessv_y&quot;</span>)
            <span style="color:#66d9ef">if</span> index <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
                poly_partial<span style="color:#f92672">.</span>invert()
            poly <span style="color:#f92672">+=</span> poly_partial

        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>x, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>x):
            <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(room<span style="color:#f92672">.</span>position<span style="color:#f92672">.</span>y, room<span style="color:#f92672">.</span>end<span style="color:#f92672">.</span>y):
                <span style="color:#66d9ef">var</span> point :<span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(x, y)
                <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Geometry</span><span style="color:#f92672">.</span>is_point_in_polygon(point, poly):
                    data[point] <span style="color:#f92672">=</span> null


<span style="color:#66d9ef">func</span> _add_connection(rng: RandomNumberGenerator, data: <span style="color:#a6e22e">Dictionary</span>, room1: <span style="color:#a6e22e">Rect2</span>, room2: <span style="color:#a6e22e">Rect2</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">var</span> room_center1 :<span style="color:#f92672">=</span> (room1<span style="color:#f92672">.</span>position <span style="color:#f92672">+</span> room1<span style="color:#f92672">.</span>end) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">var</span> room_center2 :<span style="color:#f92672">=</span> (room2<span style="color:#f92672">.</span>position <span style="color:#f92672">+</span> room2<span style="color:#f92672">.</span>end) <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">if</span> rng<span style="color:#f92672">.</span>randi_range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        _add_corridor(data, room_center1<span style="color:#f92672">.</span>x, room_center2<span style="color:#f92672">.</span>x, room_center1<span style="color:#f92672">.</span>y, <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>AXIS_X)
        _add_corridor(data, room_center1<span style="color:#f92672">.</span>y, room_center2<span style="color:#f92672">.</span>y, room_center2<span style="color:#f92672">.</span>x, <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>AXIS_Y)
    <span style="color:#66d9ef">else</span>:
        _add_corridor(data, room_center1<span style="color:#f92672">.</span>y, room_center2<span style="color:#f92672">.</span>y, room_center1<span style="color:#f92672">.</span>x, <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>AXIS_Y)
        _add_corridor(data, room_center1<span style="color:#f92672">.</span>x, room_center2<span style="color:#f92672">.</span>x, room_center2<span style="color:#f92672">.</span>y, <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>AXIS_X)


<span style="color:#66d9ef">func</span> _add_corridor(data: <span style="color:#a6e22e">Dictionary</span>, start: <span style="color:#a6e22e">int</span>, end: <span style="color:#a6e22e">int</span>, constant: <span style="color:#a6e22e">int</span>, axis: <span style="color:#a6e22e">int</span>) <span style="color:#f92672">-&gt;</span> void:
    <span style="color:#66d9ef">for</span> t <span style="color:#f92672">in</span> range(min(start, end), max(start, end) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
        <span style="color:#66d9ef">var</span> point :<span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>ZERO
        match axis:
            <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>AXIS_X: point <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(t, constant)
            <span style="color:#a6e22e">Vector2</span><span style="color:#f92672">.</span>AXIS_Y: point <span style="color:#f92672">=</span> <span style="color:#a6e22e">Vector2</span>(constant, t)
        data[point] <span style="color:#f92672">=</span> null


<span style="color:#66d9ef">func</span> _intersects(rooms: <span style="color:#a6e22e">Array</span>, room: <span style="color:#a6e22e">Rect2</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">var</span> out :<span style="color:#f92672">=</span> false
    <span style="color:#66d9ef">for</span> room_other <span style="color:#f92672">in</span> rooms:
        <span style="color:#66d9ef">if</span> room<span style="color:#f92672">.</span>intersects(room_other):
            out <span style="color:#f92672">=</span> true
            <span style="color:#66d9ef">break</span>
    <span style="color:#66d9ef">return</span> out


<span style="color:#66d9ef">func</span> _lessv_x(v1: <span style="color:#a6e22e">Vector2</span>, v2: <span style="color:#a6e22e">Vector2</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">return</span> v1<span style="color:#f92672">.</span>x <span style="color:#f92672">&lt;</span> v2<span style="color:#f92672">.</span>x


<span style="color:#66d9ef">func</span> _lessv_y(v1: <span style="color:#a6e22e">Vector2</span>, v2: <span style="color:#a6e22e">Vector2</span>) <span style="color:#f92672">-&gt;</span> <span style="color:#a6e22e">bool</span>:
    <span style="color:#66d9ef">return</span> v1<span style="color:#f92672">.</span>y <span style="color:#f92672">&lt;</span> v2<span style="color:#f92672">.</span>y
</pre>
</body>
</html>
